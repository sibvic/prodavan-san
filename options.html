<html>
<head><title>Drom.ru chrome extension options</title></head>
<style>
   input.url {
       width:900px;   
   }
</style>
<script type="text/javascript" src="util.js"></script>
<script type="text/javascript">

var last_index = -1;

// Saves options to localStorage.
function save_options() {
  var urls = new Array();
  var i;
  for (i = 0; ; ++i)
  {
    var input = document.getElementById("url_" + i);
    if (input == null)
      break;
    var inputID = document.getElementById("url_lastID_" + i);
    urls[i] = { url: input.value, data: JSON.parse(inputID.value) };
  }
  saveUrls(urls);

  // Update status to let user know options were saved.
  var status = document.getElementById("status");
  status.innerHTML = "Сохранено";
  setTimeout(function() {
    status.innerHTML = "";
  }, 750);
}

// Restores select box state to saved value from localStorage.
function restore_options() {
  var urls = loadUrls();
  if (urls.length == 0)
    return;
  for (var i = 0; i < urls.length; ++i){
    var value = urls[i].url;
    if (value == null)
        continue;
    add_more(urls[i].url, urls[i].data);
  }
}

function remove(index){
    for (var i = index; i < last_index - 1; ++i){
        var input = document.getElementById("url_" + i);
        var inputID = document.getElementById("url_lastID_" + i);
        var inputNext = document.getElementById("url_" + i);
        var inputIDNext = document.getElementById("url_lastID_" + i);
        input.value = inputNext.value;
        inputID.value = inputIDNext.value;
    }
    var input = document.getElementById("url_" + last_index);
    var inputID = document.getElementById("url_lastID_" + last_index);
    var br = document.getElementById("br_" + last_index);
    var remove = document.getElementById("remove_" + last_index);
    var div = document.getElementById("main");
    div.removeChild(input);
    div.removeChild(inputID);
    div.removeChild(br);
    div.removeChild(remove);
    last_index = last_index - 1;
}

function add_more(url, data){
    last_index = last_index + 1;
    var div = document.getElementById("main");

    var input = document.createElement("input");
    div.appendChild(input);
    input.setAttribute('id', "url_" + last_index);
    input.setAttribute('value', url);
    input.setAttribute('class', "url");
    var input2 = document.createElement("input");
    div.appendChild(input2);
    input2.setAttribute('id', "url_lastID_" + last_index);
    input2.setAttribute('type', "hidden");
    input2.setAttribute('value', JSON.stringify(data));
    
    var remove = document.createElement("div");
    remove.appendChild(document.createTextNode("Удалить"));
    remove.setAttribute('id', "remove_" + last_index);
    remove.setAttribute('onClick', "remove(" + last_index + ")");
    div.appendChild(remove);
    
    var br = document.createElement("br");
    br.setAttribute('id', "br_" + last_index);
    div.appendChild(br);
}

</script>

<body onload="restore_options()">

Следить за:<br/>
<div id="main">
</div>
<button onclick="add_more('', '')">Добавить ещё</button><button onclick="save_options()">Сохранить</button>
<p id="status" />
</body>
</html>
